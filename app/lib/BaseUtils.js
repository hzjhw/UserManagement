define("BaseUtils",["jquery","HandlebarsHelper","BaseCollection"],function(t,e,a){var i,n;n=t("HandlebarsHelper"),i={initSelect:function(t){var e=Est.promise;return new e(function(e){var a={},i=t.target||"#category",n=t.render||"#s1",o=t.itemId||"value",s=t.width||"150",u=t.items||[];BUI.use("bui/select",function(c){a[n]=new c.Select({render:n,valueField:i,width:s,items:u}),a[n].render(),a[n].on("change",function(a){$(i).val(Est.trim(a.item[o])),"undefined"!=typeof t.change&&t.change.call(this,a.item[o]),e(a.item[o])})})})},getProductCategory:function(t){debug("getProductCategory");var e=Est.promise;return new e(function(a){t.select=t&&t.select?!0:!1,t.extend=t&&t.extend?!0:!1;var i=function(){return new e(function(t){$.ajax({type:"post",url:CONST.API+"/category/product?pageSize=1000",async:!1,data:{_method:"GET"},success:function(e){t(e)}})})};i().then(function(e){e.attributes?(e.attributes.data=Est.bulidTreeNode(e.attributes.data,"grade","00",{categoryId:"categoryId",belongId:"belongId",childTag:"cates",sortBy:"sort",callback:function(t){t.text=t.name,t.value=t.categoryId}}),t.select&&(e.attributes.data=Est.bulidSelectNode(e.attributes.data,1,{name:"text"})),t.extend&&(e.attributes.data=Est.extendTree(e.attributes.data))):e.attributes.data=[],e.attributes.data.unshift({text:"请选择分类",value:"/"}),a(e.attributes.data)})})},getAlbumList:function(t){var e=[];return $.ajax({type:"post",url:CONST.API+"/album/list?pageSize=1000",async:!1,data:{_method:"GET"},success:function(a){a.attributes?(a.attributes.data=Est.bulidTreeNode(a.attributes.data,"parentId",null,{categoryId:"albumId",belongId:"parentId",childTag:"cates",callback:function(t){t.text=t.name,t.value=t.albumId}}),t.select&&(a.attributes.data=Est.bulidSelectNode(a.attributes.data,1,{name:"text"})),t.extend&&(a.attributes.data=Est.extendTree(a.attributes.data))):a.attributes.data=[],a.attributes.data.unshift({text:"请选择分类",value:""}),e=a.attributes.data}}),e},getNewsCategory:function(t){return debug("getNewsCategory"),new Est.promise(function(e){t.select=t&&t.select?!0:!1,t.extend=t&&t.extend?!0:!1;var a=function(){return new Est.promise(function(t){$.ajax({type:"post",url:CONST.API+"/category/news?pageSize=1000",async:!1,data:{_method:"GET"},success:function(e){t(e)}})})};a().then(function(a){a.attributes?(a.attributes.data=Est.bulidTreeNode(a.attributes.data,"grade","01",{categoryId:"categoryId",belongId:"belongId",childTag:"cates",sortBy:"sort",callback:function(t){t.text=t.name,t.value=t.categoryId}}),t.select&&(a.attributes.data=Est.bulidSelectNode(a.attributes.data,1,{name:"text"})),t.extend&&(a.attributes.data=Est.extendTree(a.attributes.data))):a.attributes.data=[],a.attributes.data.unshift({text:"请选择分类",value:"/"}),e(a.attributes.data)})})},initDate:function(t){BUI.use("bui/calendar",function(e){new e.DatePicker({trigger:t.render||".calendar",showTime:t.showTime||!1,autoRender:!0})})},initCombox:function(t){var e=Est.promise;return new e(function(){var e={},a=t.target||"#category",i=t.render||"#s1",n=(t.itemId||"categoryId",t.width||"500"),o=t.items||[];BUI.use("bui/select",function(t){e[i]=new t.Combox({render:i,showTag:!0,valueField:a,elCls:"bui-tag-follow",width:n,items:o}),e[i].render()})})},initEditor:function(t){seajs.use(["xheditor"],function(){function e(t){$(t).xheditor({tools:"Preview,Fullscreen,Source,|,contact,abbccQQ,abbccMap,abbccLayout,abbccQrcode,|,Table,abbccImages,abbccFlash,Media,|,FontColor,BackColor,|,Align,Underline,Italic,Bold,|,FontSize,Fontface,|,Link,Unlink",layerShadow:2,html5Upload:!1,upBtnText:"浏览",upLinkExt:"jpg,png,bmp",upImgUrl:"/fileUpload/uploadByJson",upFlashUrl:"/fileUpload/uploadByJson",upMediaUrl:"/fileUpload/uploadByJson",upFlashExt:"swf",upMediaExt:"wmv,avi,wma,mp3,mid",linkTag:!0,internalScript:!0,inlineScript:!0})}$(function(){$(t.render||".ckeditor").each(function(){e($(this))})})})},tip:function(t,e){e=e||{time:2e3,title:"提示信息："},seajs.use(["dialog-plus"],function(a){window.dialog=a,window.tipsDialog=a({id:"tip-dialog",title:e.title,width:200,content:t}).show(),setTimeout(function(){window.tipsDialog.close()},e.time)})},comfirm:function(t){var e={title:"提示",content:"是否删除！",success:function(){},target:null};Est.extend(e,t),seajs.use(["dialog-plus"],function(t){t({title:e.title,content:e.content,width:150,button:[{value:"确定",autofocus:!0,callback:function(){e.success.call(this)}},{value:"取消",callback:function(){this.close()}}]}).show(e.target)})},logout:function(){$.ajax({type:"GET",async:!1,url:CONST.API+"/user/logout",success:function(){window.location.href=CONST.HOST+"/modules/login/login.html"}})},resetIframe:function(){try{window.detailDialog&&window.detailDialog.height&&(window.detailDialog.height($(document).height()),window.detailDialog.reset())}catch(t){console.error("【error】: BaseDetail.resetIframe"+t)}},dialog:function(t){var e=[];t.success&&e.push({value:"确定",autofocus:!0,callback:function(){t.success.call(this,arguments)}}),e.push({value:"关闭",callback:function(){this.close()}}),t=Est.extend({title:"对话框",width:150,height:"auto",button:e},t),t.target&&(t.target=$(t.target).get(0)),seajs.use(["dialog"],function(e){e(t).show(t.target)})},iframeDialog:function(t){var e=[];t.success&&e.push({value:"确定",autofocus:!0,callback:function(){t.success.call(this)}}),e.push({value:"关闭",callback:function(){this.close()}}),t=Est.extend({title:"窗口",url:"",width:150,height:"auto",target:null,button:e},t),seajs.use(["dialog-plus"],function(e){e(t).show(t.target)})}},a.exports=i});