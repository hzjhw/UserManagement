define("BaseDetail",["SuperView","HandlebarsHelper","Utils","Service"],function(t,e,i){var s,n,o,a,r;n=t("SuperView"),o=t("HandlebarsHelper"),a=t("Utils"),r=t("Service"),s=n.extend({_initialize:function(t){this._initOptions(t),this._initTemplate(this._options),this._initList(this._options),this._initModel(t.model,this),this._initEnterEvent(this._options)},_initOptions:function(t){this._options=Est.extend(t||{},this.options),this._options.speed=this._options.speed||9},_initTemplate:function(t){return this._data=t.data=t.data||{},t.template&&(this.template=o.compile(t.template)),this._data},_initList:function(t){var e=this;return this.list=t.render?this.$(t.render):this.$el,0===this.list.size()&&(this.list=$(t.render)),debug(function(){return e.list&&0!==e.list.size()?void 0:"当前"+e.options.viewId+"视图无法找到选择符， 检查XxxDetail中的_initialize方法中是否定义render或 实例化对象(new XxxDetail({...}))中是否存入el; 或template模板是否引入， 或是否是iframe对话框中未重新实例化Application对象， 或检查template模板是否存在"+(e._options.render?e._options.render:e.el)},{type:"error"}),this.list},_render:function(){this.list.append(this.template(this.model.toJSON())),this._options.modelBind&&this._modelBind(),window.topDialog&&this.$(".form-actions").hide(),this._options.afterRender&&this._options.afterRender.call(this,this._options),setTimeout(function(){a.resetIframe()},1e3)},_initModel:function(t,e){e.passId=this.options.id||Est.getUrlParam("id",window.location.href),debug(function(){return t?void 0:"XxxDetail未找到模型类， 请检查继承BaseDetail时是否设置model参数，如XxxDetail = BaseDetail.extend({model: XxxModel, initialize: function(){..}})"},{type:"error"}),Est.isEmpty(this.passId)?(e.passId=(new Date).getTime(),e.model=new t,e.model.set("_data",e._options.data),e.model.set("_isAdd",e._isAdd=!0),e.render()):(e.model=new t,e.model.set("id",e.passId),e.model.set("_data",e._options.data),e.model.fetch().done(function(){e.model.set("_isAdd",e._isAdd=!1),e.render()}))},_form:function(t){return this.formSelector=t,this.formElemnet=this.$(this.formSelector),this},_validate:function(t){var e=this;return t=t||{},BUI.use("bui/form",function(i){e.formValidate=new i.Form({srcNode:e.formSelector}).render(),t.url&&t.fields&&Est.each(t.fields,function(i){app.addData(i,e.formValidate.getField(i)),debug(function(){return e.formValidate.getField(i)?void 0:"字段不匹配，检查input元素name值是否以vali-开头？"},{type:"error"}),app.getData(i).set("remote",{url:t.url,dataType:"json",callback:function(t){return t.success?"":t.msg}})})}),this},_init:function(t){var e=this,i=!0,s={};t=t||{},$("#submit",this.el).on("click",function(){var n=$(this),o=e.preText=$(this).html();i=!0,e.formElemnet.submit(),$("input, textarea, select",$(e.formSelector)).each(function(){var t,n,o,a,r;t=$(this).attr("name"),$(this).hasClass("bui-form-field-error")&&(i=!1);var l=$(this).attr("id");if(l&&-1!==l.indexOf("model")){switch(this.type){case"radio":n=$(this).is(":checked")?$(this).val():o=!0;break;case"checkbox":n=$(this).is(":checked")?Est.isEmpty($(this).attr("true-value"))?!0:$(this).attr("true-value"):Est.isEmpty($(this).attr("false-value"))?!1:$(this).attr("false-value");break;default:n=$(this).val()}o||(a=l.replace(/^model\d?-(.+)$/g,"$1"),r=a.split("."),r.length>1?(Est.setValue(s,a,n),e.model.set(r[0],s[r[0]])):e.model.set(r[0],n))}}),i&&("undefined"!=typeof t.onBeforeSave&&t.onBeforeSave.call(e),n.html("提交中..."),e._save(function(i){t.onAfterSave&&(t.onAfterSave=Est.inject(t.onAfterSave,function(){return new Est.setArguments(arguments)},function(){n.html(o)}),t.onAfterSave.call(e,i)),n.html(o)}))})},_save:function(t){this._saveItem(t)},_saveItem:function(t,e){return debug("- BaseDetail._saveItem"),Est.isEmpty(this.model.url())?void debug("XxxModel模型类未设置url参数！",{type:"error"}):void this.model.save(null,{wait:!0,success:function(i){debug("- BaseDetail._saveSuccess"),app.addModel(Est.cloneDeep(i.attributes)),top&&(top.model=i.attributes),t&&"function"==typeof t&&t.call(e,i)}})},_reset:function(){this.model.set(this.model.defaults)},_empty:function(){this.model.off(),this.$el.empty().off()},_close:function(){debug("- BaseDetail.close"),this.undelegateEvents(),this.stopListening(),this.off()}}),i.exports=s});