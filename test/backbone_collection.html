<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="styles/todos.css"/>
</head>
<body>
<div>event test</div>
<script type="text/javascript" src="../scripts/base.js"></script>
<script type="text/javascript">
    (function () {

        // 定义模型类
        var Book = Backbone.Model.extend({
            defaults : {
                name : ''
            }
        });

        // 定义集合类
        var BookList = Backbone.Collection.extend({
            model : Book
        });

        // 创建一系列模型对象
        var book1 = new Book({
            name : 'Effective Java中文版(第2版)'
        });
        var book2 = new Book({
            name : 'JAVA核心技术卷II：高级特性（原书第8版）'
        });
        var book3 = new Book({
            name : '精通Hibernate：Java对象持久化技术详解（第2版）'
        });

        // 创建集合对象
        var books = new BookList([book1, book2, book3]);


        // 使用克隆的方法复制Book对象
        var book1 = new Book({
            name : 'Effective Java中文版(第2版)'
        });

        var book2 = book1.clone();
        book2.set('name', 'JAVA核心技术卷II：高级特性（原书第8版）');

        var book3 = book1.clone();
        book3.set('name', '精通Hibernate：Java对象持久化技术详解（第2版）');



        // 使用数组初始化集合
        var models = [{
            name : 'Effective Java中文版(第2版)'
        }, {
            name : 'JAVA核心技术卷II：高级特性（原书第8版）'
        }, {
            name : '精通Hibernate：Java对象持久化技术详解（第2版）'
        }];

        // 创建集合对象
        var books = new BookList(models);



        // 简单创建集合
        var models = [{
            name : 'Effective Java中文版(第2版)'
        }, {
            name : 'JAVA核心技术卷II：高级特性（原书第8版）'
        }, {
            name : '精通Hibernate：Java对象持久化技术详解（第2版）'
        }];

        // 创建集合对象
        var books = new Backbone.Collection(models, {
            model : Book
        });


        // books.remove()：从集合中移除一个或多个指定的模型对象
        // books.pop()：移除集合尾部的一个模型对象
        // books.shift()：移除集合头部的一个模型对象

        // books.get()：根据模型的唯一标识（id）查找模型对象
        // books.getByCid()：根据模型的cid查找模型对象
        // books.at()：查找集合中指定位置的模型对象
        // books.where()：根据数据对集合的模型进行筛选


        // 集合排序
        var books = new Backbone.Collection(null, {
            model : Book,
            comparator : function(m1, m2) {
                var price1 = m1.get('price');
                var price2 = m2.get('price');

                if(price1 > price2) {
                    return 1;
                } else {
                    return 0;
                }
            }
        });

        // 从服务器里获取数据
        // 定义模型类
        var Book = Backbone.Model.extend({
            defaults : {
                name : '',
                price : 0
            }
        });

        // 定义集合类
        var BookList = Backbone.Collection.extend({
            model : Book,
            url : '/service'
        });


        var books = new BookList();
        books.add({
            id : 1000,
            name : 'Thinking in Java',
            price : 395.70
        });

        books.fetch({
            add: true,  // 表示追加  而不是覆盖
            success : function(collection, resp) {
                // 同步成功后在控制台输出集合中的模型列表
                console.dir(collection.models);
            }
        });

        // 向集合中添加数据， 并保存到服务器中
        var books = new BookList();
        // 创建一个模型
        books.create({
            name : 'Thinking in Java',
            price : 395.70
        }, {
            success : function(model, resp) {
                // 添加成功后, 在控制台输出集合中的模型列表
                console.dir(books.models);
            }
        });

        // 批量添加， 修改， 删除操作
        var BookList = Backbone.Collection.extend({
            model : Book,
            url : '/service',
            // 将集合中所有的模型id连接为一个字符串并返回
            getIds : function() {
                return _(this.models).map(function(model) {
                    return model.id;
                }).join(',');
            },
            // 将集合中所有模型提交到服务器接口
            createAll : function(options) {
                return Backbone.sync.call(this, 'create', this, options);
            },
            // 修改集合中的所有模型数据
            updateAll : function(options) {
                return Backbone.sync.call(this, 'update', this, options);
            },
            // 删除集合中所有的模型
            deleteAll : function(options) {
                var result = Backbone.sync.call(this, 'delete', this, _.extend({
                    url : this.url + '/' + this.getIds()
                }, options));
                this.remove(this.models);
                return result;
            }
        });

        // 创建集合对象
        var books = new BookList();

        // 当集合触发reset事件时, 对数据进行批量同步
        books.on('reset', function() {
            books.createAll();
            books.updateAll();
            books.deleteAll();
        });

        // 从服务器接口同步默认数据
        books.fetch();


    }).call(this);
</script>
</body>
</html>


